# Service Orders Charges by Type - Semantic Types Reference

## Overview

This document provides a quick reference for setting semantic types in Metabase for the **Service Orders Charges by Type** model.

**For detailed column mapping**: See [`SERVICE_ORDERS_CHARGES_BY_TYPE.md`](./SERVICE_ORDERS_CHARGES_BY_TYPE.md)

## Semantic Types by Column

| Column Name | Database Column (Recurring Credits) | Database Column (Other Charges) | Semantic Type | Priority |
|------------|-----------------------------------|----------------------------------|---------------|----------|
| `CHARGE_TYPE` | Literal: 'Recurring Credit' | Literal: 'Other Charge' | **Category** | ⭐ **HIGH** |
| `ORDER_ID` | `SERVICEORDERS.ORDER_ID` | `SERVICEORDERS.ORDER_ID` | **Entity Key** | ⭐ **HIGH** |
| `SERVICEORDER_ID` | `SERVICEORDERS.SERVICEORDER_ID` | `SERVICEORDERS.SERVICEORDER_ID` | **Entity Key** | ⭐ **HIGH** |
| `ACCOUNT_ID` | `SERVICEORDERS.ACCOUNT_ID` | `SERVICEORDERS.ACCOUNT_ID` | **Entity Key** | ⭐ **HIGH** |
| `ACCOUNT_NUMBER` | `SERVICEORDERS.ACCOUNT_NUMBER` | `SERVICEORDERS.ACCOUNT_NUMBER` | **Entity Key** | Medium |
| `SERVICEORDER_STATUS` | `SERVICEORDERS.STATUS` | `SERVICEORDERS.STATUS` | **Category** | ⭐ **HIGH** |
| `SERVICEORDER_TYPE` | `SERVICEORDERS.SERVICEORDER_TYPE` | `SERVICEORDERS.SERVICEORDER_TYPE` | **Category** | Medium |
| `SERVICELINE_NUMBER` | `SERVICEORDERS.SERVICELINE_NUMBER` | `SERVICEORDERS.SERVICELINE_NUMBER` | **Entity Key** | Medium |
| `SALES_AGENT` | `SERVICEORDERS.SALES_AGENT` | `SERVICEORDERS.SALES_AGENT` | **Entity Name** | ⭐ **HIGH** |
| `SERVICEORDER_CREATED` | `SERVICEORDERS.CREATED_DATETIME` | `SERVICEORDERS.CREATED_DATETIME` | **Creation Timestamp** | Medium |
| `SERVICEORDER_MODIFIED` | `SERVICEORDERS.MODIFIED_DATETIME` | `SERVICEORDERS.MODIFIED_DATETIME` | **Modification Timestamp** | Low |
| `APPLY_DATE` | `SERVICEORDERS.APPLY_DATE` | `SERVICEORDERS.APPLY_DATE` | **Date** | Low |
| `TARGET_DATETIME` | `SERVICEORDERS.TARGET_DATETIME` | `SERVICEORDERS.TARGET_DATETIME` | **Date** | Low |
| `SERVICELINE_STARTDATE` | `SERVICELINES.SERVICELINE_STARTDATE` | `SERVICELINES.SERVICELINE_STARTDATE` | **Creation Timestamp** | ⭐ **HIGH** |
| `SERVICELINE_ENDDATE` | `SERVICELINES.SERVICELINE_ENDDATE` | `SERVICELINES.SERVICELINE_ENDDATE` | **Date** | Low |
| `SERVICELINE_STATUS` | `SERVICELINES.SERVICELINE_STATUS` | `SERVICELINES.SERVICELINE_STATUS` | **Category** | Medium |
| `SERVICELINE_SERVICE_MODEL` | `SERVICELINES.SERVICE_MODEL` | `SERVICELINES.SERVICE_MODEL` | **Category** | Medium |
| `CHARGE_TYPE_NAME` | `ACCOUNT_RECURRING_CREDITS.RECURRING_CREDIT_NAME` | `ACCOUNT_OTHER_CHARGES_CREDITS.ITEM_TYPE` | **Category** | ⭐ **HIGH** |
| `CHARGE_AMOUNT` | `SUM(ACCOUNT_RECURRING_CREDITS.RECURRING_CREDIT_AMOUNT)` | `SUM(ACCOUNT_OTHER_CHARGES_CREDITS.OCC_AMOUNT)` | **Currency** | ⭐ **HIGH** |
| `CHARGE_COUNT` | `COUNT(*)` (aggregated) | `COUNT(*)` (aggregated) | **Number** | Medium |
| `CHARGE_STATUS` | `ACCOUNT_RECURRING_CREDITS.ACCOUNT_RECURRING_STATUS` | `ACCOUNT_OTHER_CHARGES_CREDITS.OCC_STATUS` | **Category** | Medium |
| `CHARGE_EARLIEST_START` | `MIN(ACCOUNT_RECURRING_CREDITS.RECURRING_CREDIT_START_DATETIME)` | `MIN(ACCOUNT_OTHER_CHARGES_CREDITS.OCC_DATETIME)` | **Creation Timestamp** | Low |
| `CHARGE_LATEST_END` | `MAX(ACCOUNT_RECURRING_CREDITS.RECURRING_CREDIT_END_DATETIME)` | `MAX(ACCOUNT_OTHER_CHARGES_CREDITS.OCC_DATETIME)` | **Date** | Low |
| `OCC_ITEM_TYPE` | `CAST(NULL AS TEXT)` | `ACCOUNT_OTHER_CHARGES_CREDITS.ITEM_TYPE` | **Category** | Low |
| `OCC_ITEM_NAME` | `CAST(NULL AS TEXT)` | `ACCOUNT_OTHER_CHARGES_CREDITS.ITEM_NAME` | **Category** | Low |
| `OCC_DATETIME` | `CAST(NULL AS TIMESTAMP_NTZ)` | `MAX(ACCOUNT_OTHER_CHARGES_CREDITS.OCC_DATETIME)` | **Creation Timestamp** | Low |

## Priority Fields for Analysis

### ⭐ High Priority (Set These First)

1. **CHARGE_TYPE** (Category) - Essential for filtering/separating recurring credits vs other charges
2. **CHARGE_TYPE_NAME** (Category) - The actual charge type name (RECURRING_CREDIT_NAME or ITEM_TYPE)
3. **CHARGE_AMOUNT** (Currency) - Primary metric: sum of charges by type
4. **SALES_AGENT** (Entity Name) - Required for sales commission calculations
5. **SERVICELINE_STARTDATE** (Creation Timestamp) - Required: Service line start date
6. **ORDER_ID** (Entity Key) - Primary identifier for orders
7. **SERVICEORDER_ID** (Entity Key) - Service order identifier (joins to Fybe WORK_PACKAGE)
8. **ACCOUNT_ID** (Entity Key) - Account identifier
9. **SERVICEORDER_STATUS** (Category) - Should always be 'COMPLETED' (filtered)

## Full Database Column Paths

### Recurring Credits Query Columns

```
Literal: 'Recurring Credit' → CHARGE_TYPE
CAMVIO.PUBLIC.SERVICEORDERS.ORDER_ID → ORDER_ID
CAMVIO.PUBLIC.SERVICEORDERS.SERVICEORDER_ID → SERVICEORDER_ID
CAMVIO.PUBLIC.SERVICEORDERS.ACCOUNT_ID → ACCOUNT_ID
CAMVIO.PUBLIC.SERVICEORDERS.ACCOUNT_NUMBER → ACCOUNT_NUMBER
CAMVIO.PUBLIC.SERVICEORDERS.STATUS → SERVICEORDER_STATUS
CAMVIO.PUBLIC.SERVICEORDERS.SERVICEORDER_TYPE → SERVICEORDER_TYPE
CAMVIO.PUBLIC.SERVICEORDERS.SERVICELINE_NUMBER → SERVICELINE_NUMBER
CAMVIO.PUBLIC.SERVICEORDERS.SALES_AGENT → SALES_AGENT
CAMVIO.PUBLIC.SERVICEORDERS.CREATED_DATETIME → SERVICEORDER_CREATED
CAMVIO.PUBLIC.SERVICEORDERS.MODIFIED_DATETIME → SERVICEORDER_MODIFIED
CAMVIO.PUBLIC.SERVICEORDERS.APPLY_DATE → APPLY_DATE
CAMVIO.PUBLIC.SERVICEORDERS.TARGET_DATETIME → TARGET_DATETIME
CAMVIO.PUBLIC.SERVICELINES.SERVICELINE_STARTDATE → SERVICELINE_STARTDATE
CAMVIO.PUBLIC.SERVICELINES.SERVICELINE_ENDDATE → SERVICELINE_ENDDATE
CAMVIO.PUBLIC.SERVICELINES.SERVICELINE_STATUS → SERVICELINE_STATUS
CAMVIO.PUBLIC.SERVICELINES.SERVICE_MODEL → SERVICELINE_SERVICE_MODEL
CAMVIO.PUBLIC.ACCOUNT_RECURRING_CREDITS.RECURRING_CREDIT_NAME → CHARGE_TYPE_NAME
SUM(CAMVIO.PUBLIC.ACCOUNT_RECURRING_CREDITS.RECURRING_CREDIT_AMOUNT) → CHARGE_AMOUNT
COUNT(*) → CHARGE_COUNT
CAMVIO.PUBLIC.ACCOUNT_RECURRING_CREDITS.ACCOUNT_RECURRING_STATUS → CHARGE_STATUS
MIN(CAMVIO.PUBLIC.ACCOUNT_RECURRING_CREDITS.RECURRING_CREDIT_START_DATETIME) → CHARGE_EARLIEST_START
MAX(CAMVIO.PUBLIC.ACCOUNT_RECURRING_CREDITS.RECURRING_CREDIT_END_DATETIME) → CHARGE_LATEST_END
CAST(NULL AS TEXT) → OCC_ITEM_TYPE
CAST(NULL AS TEXT) → OCC_ITEM_NAME
CAST(NULL AS TIMESTAMP_NTZ) → OCC_DATETIME
```

### Other Charges Query Columns

```
Literal: 'Other Charge' → CHARGE_TYPE
CAMVIO.PUBLIC.SERVICEORDERS.ORDER_ID → ORDER_ID
CAMVIO.PUBLIC.SERVICEORDERS.SERVICEORDER_ID → SERVICEORDER_ID
CAMVIO.PUBLIC.SERVICEORDERS.ACCOUNT_ID → ACCOUNT_ID
CAMVIO.PUBLIC.SERVICEORDERS.ACCOUNT_NUMBER → ACCOUNT_NUMBER
CAMVIO.PUBLIC.SERVICEORDERS.STATUS → SERVICEORDER_STATUS
CAMVIO.PUBLIC.SERVICEORDERS.SERVICEORDER_TYPE → SERVICEORDER_TYPE
CAMVIO.PUBLIC.SERVICEORDERS.SERVICELINE_NUMBER → SERVICELINE_NUMBER
CAMVIO.PUBLIC.SERVICEORDERS.SALES_AGENT → SALES_AGENT
CAMVIO.PUBLIC.SERVICEORDERS.CREATED_DATETIME → SERVICEORDER_CREATED
CAMVIO.PUBLIC.SERVICEORDERS.MODIFIED_DATETIME → SERVICEORDER_MODIFIED
CAMVIO.PUBLIC.SERVICEORDERS.APPLY_DATE → APPLY_DATE
CAMVIO.PUBLIC.SERVICEORDERS.TARGET_DATETIME → TARGET_DATETIME
CAMVIO.PUBLIC.SERVICELINES.SERVICELINE_STARTDATE → SERVICELINE_STARTDATE
CAMVIO.PUBLIC.SERVICELINES.SERVICELINE_ENDDATE → SERVICELINE_ENDDATE
CAMVIO.PUBLIC.SERVICELINES.SERVICELINE_STATUS → SERVICELINE_STATUS
CAMVIO.PUBLIC.SERVICELINES.SERVICE_MODEL → SERVICELINE_SERVICE_MODEL
CAMVIO.PUBLIC.ACCOUNT_OTHER_CHARGES_CREDITS.ITEM_TYPE → CHARGE_TYPE_NAME
SUM(CAMVIO.PUBLIC.ACCOUNT_OTHER_CHARGES_CREDITS.OCC_AMOUNT) → CHARGE_AMOUNT
COUNT(*) → CHARGE_COUNT
CAMVIO.PUBLIC.ACCOUNT_OTHER_CHARGES_CREDITS.OCC_STATUS → CHARGE_STATUS
MIN(CAMVIO.PUBLIC.ACCOUNT_OTHER_CHARGES_CREDITS.OCC_DATETIME) → CHARGE_EARLIEST_START
MAX(CAMVIO.PUBLIC.ACCOUNT_OTHER_CHARGES_CREDITS.OCC_DATETIME) → CHARGE_LATEST_END
CAMVIO.PUBLIC.ACCOUNT_OTHER_CHARGES_CREDITS.ITEM_TYPE → OCC_ITEM_TYPE
CAMVIO.PUBLIC.ACCOUNT_OTHER_CHARGES_CREDITS.ITEM_NAME → OCC_ITEM_NAME
MAX(CAMVIO.PUBLIC.ACCOUNT_OTHER_CHARGES_CREDITS.OCC_DATETIME) → OCC_DATETIME
```

## Setting Semantic Types in Metabase

### Method 1: Model Settings (Recommended)

1. Open the **Service Orders Charges by Type** model
2. Click **Model settings** (gear icon)
3. Go to **Column metadata** tab
4. For each column:
   - Set **Semantic type** from dropdown
   - Review **Database column** (shown automatically)
5. Save changes

### Method 2: Individual Column Settings

1. Open the model
2. Click on a column header
3. Select **Column settings**
4. Set **Semantic type**
5. Save

## Quick Setup Checklist

- [ ] Set `CHARGE_TYPE` → **Category**
- [ ] Set `CHARGE_TYPE_NAME` → **Category**
- [ ] Set `CHARGE_AMOUNT` → **Currency**
- [ ] Set `SALES_AGENT` → **Entity Name**
- [ ] Set `SERVICELINE_STARTDATE` → **Creation Timestamp**
- [ ] Set `ORDER_ID` → **Entity Key**
- [ ] Set `SERVICEORDER_ID` → **Entity Key**
- [ ] Set `ACCOUNT_ID` → **Entity Key**
- [ ] Set `ACCOUNT_NUMBER` → **Entity Key**
- [ ] Set `SERVICELINE_NUMBER` → **Entity Key**
- [ ] Set `SERVICEORDER_STATUS` → **Category**
- [ ] Set `SERVICEORDER_TYPE` → **Category**
- [ ] Set `SERVICELINE_STATUS` → **Category**
- [ ] Set `SERVICELINE_SERVICE_MODEL` → **Category**
- [ ] Set `CHARGE_STATUS` → **Category**
- [ ] Set `OCC_ITEM_TYPE` → **Category**
- [ ] Set `OCC_ITEM_NAME` → **Category**
- [ ] Set `CHARGE_COUNT` → **Number**
- [ ] Set `SERVICEORDER_CREATED` → **Creation Timestamp**
- [ ] Set `SERVICEORDER_MODIFIED` → **Modification Timestamp**
- [ ] Set `CHARGE_EARLIEST_START` → **Creation Timestamp**
- [ ] Set `CHARGE_LATEST_END` → **Date**
- [ ] Set `OCC_DATETIME` → **Creation Timestamp**
- [ ] Set date fields (`APPLY_DATE`, `TARGET_DATETIME`, `SERVICELINE_ENDDATE`) → **Date**

## Notes

- **UNION ALL Structure**: This model uses UNION ALL to combine recurring credits and other charges. Some fields are NULL for one type (e.g., `OCC_ITEM_TYPE`, `OCC_ITEM_NAME`, `OCC_DATETIME` are NULL for recurring credits).

- **Aggregated Fields**: 
  - `CHARGE_AMOUNT` is a SUM aggregation (sum of charges by type per service order)
  - `CHARGE_COUNT` is a COUNT aggregation (number of charges of this type per service order)
  - `CHARGE_EARLIEST_START` is MIN aggregation
  - `CHARGE_LATEST_END` is MAX aggregation

- **Multiple Rows Per Service Order**: This model creates multiple rows per service order if there are multiple charge types. Each row represents one charge type for that service order.

- **Currency Field**: Setting `CHARGE_AMOUNT` as Currency enables proper formatting and currency-specific aggregations in Metabase.

- **Entity Name**: Setting `SALES_AGENT` as Entity Name enables better person name handling and search, which is important for sales commission reporting.

- **Charge Type Distinction**: The `CHARGE_TYPE` field ('Recurring Credit' vs 'Other Charge') and `CHARGE_TYPE_NAME` field (the actual type name) are both important for filtering and grouping.

